{% set base_ip = ansible_default_ipv4.address %}
{% set ip_parts = base_ip.split('.') %}
{% set seed = ip_parts[3] | int %}
$TTL    604800
@       IN      SOA     ocp-svc.{{ base_domain }}. contact.{{ base_domain }} (
                  1     ; Serial
             604800     ; Refresh
              86400     ; Retry
            2419200     ; Expire
             604800     ; Minimum
)
        IN      NS      ocp-svc

ocp-svc.{{ base_domain }}.          IN      A       {{ base_ip }}

; Temp Bootstrap Node
ocp-bootstrap.lab.{{ base_domain }}.        IN      A      {{ ip_parts[0] }}.{{ ip_parts[1] }}.{{ ip_parts[2] }}.{{ seed + 19 }}

; Control Plane Nodes
{% for i in range(3) %}
ocp-cp-{{ i + 1 }}.lab.{{ base_domain }}.         IN      A      {{ ip_parts[0] }}.{{ ip_parts[1] }}.{{ ip_parts[2] }}.{{ seed + 14 + i }}
{% endfor %}

; Worker Nodes
{% for i in range(2) %}
ocp-w-{{ i + 1 }}.lab.{{ base_domain }}.         IN      A      {{ ip_parts[0] }}.{{ ip_parts[1] }}.{{ ip_parts[2] }}.{{ seed + 17 + i }}
{% endfor %}

; OpenShift Internal - Load balancer
api.{{ base_domain }}.        IN      A      {{ base_ip }}
api-int.{{ base_domain }}.    IN      A      {{ base_ip }}
*.apps.lab.{{ base_domain }}.   IN      A      {{ base_ip }}

; ETCD Cluster
{% for i in range(3) %}
etcd-{{ i }}.lab.{{ base_domain }}.    IN      A     {{ ip_parts[0] }}.{{ ip_parts[1] }}.{{ ip_parts[2] }}.{{ seed + 14 + i }}
{% endfor %}

; OpenShift Internal SRV records (cluster name = lab)
{% for i in range(3) %}
_etcd-server-ssl._tcp.lab.{{ base_domain }}.    86400     IN      SRV     0    10    2380    etcd-{{ i }}.lab
{% endfor %}

oauth-openshift.apps.lab.{{ base_domain }}.     IN      A      {{ base_ip }}
console-openshift-console.apps.lab.{{ base_domain }}.     IN      A      {{ base_ip }}
